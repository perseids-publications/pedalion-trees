/*
 * Arethusa - a backend-independent client-side annotation framework
 * http://github.com/alpheios-project/arethusa
 *
 * Version 0.2.5
 * built from branch master
 * at 449ee3e5eb26fba7ede57b24be71aac565de0667
 * on 2017-06-07T14:58:53.301Z
 *
 * Published under the MIT license
 */

"use strict";angular.module("arethusa.sg",[]),angular.module("arethusa.sg").directive("sgAncestors",["sg",function(a){return{restrict:"A",scope:{obj:"=sgAncestors"},link:function(b,c,d){function e(a){b.hierarchy=b.obj.definingAttrs.concat(b.obj.ancestors)}b.requestGrammar=function(b){b.sections&&(a.readerRequested===b?a.readerRequested=!1:a.readerRequested=b)},b.requested=function(b){return a.readerRequested["short"]===b["short"]},b.$watch("obj.hasChanged",function(a,c){a&&(e(),b.obj.hasChanged=!1)}),b.$watchCollection("obj.ancestors",function(a,b){e()})},templateUrl:"js/arethusa.sg/templates/ancestors.html"}}]),angular.module("arethusa.sg").directive("sgContextMenuSelector",["sg",function(a){return{restrict:"A",scope:{obj:"="},link:function(b,c,d){function e(a){return arethusaUtil.map(a,function(a){return a["short"]}).join(" > ")}b.sg=a,b.$watchCollection("obj.ancestors",function(a,c){b.heading=0===a.length?"Select Smyth Categories":e(a)})},templateUrl:"js/arethusa.sg/templates/sg_context_menu_selector.html"}}]),angular.module("arethusa.sg").directive("sgGrammarReader",["sg","state",function(a,b){return{restrict:"A",link:function(c,d,e){function f(){return angular.element(document.getElementById("sg-g-r"))}function g(){f().empty()}function h(b){var c=f();a.requestGrammar(b.sections,function(a){c.append(a)})}c.s=b,c.sg=a,c.isVisible=function(){return a.readerRequested&&b.hasSelections()},c.$watch("sg.readerRequested",function(a,b){a&&(g(),h(a))})},templateUrl:"js/arethusa.sg/templates/sg_grammar_reader.html"}}]),angular.module("arethusa.sg").factory("Range",function(){return function(a,b){var c=this;try{a.match(/-/)&&(a=a.split("-"))}catch(d){}if(arethusaUtil.isArray(a)?(this.start=a[0],this.end=a[1]||a[0]):(this.start=a,this.end=b||this.start),this.start=parseInt(this.start),this.end=parseInt(this.end),this.length=this.end-this.start+1,this.end<this.start)throw new RangeError("End ("+b+") is less than start ("+a+")");this.includes=function(a){return a>=c.start&&a<=c.end},this.includesOtherRange=function(a){return c.includes(a.start)&&c.includes(a.end)},this.sharesElements=function(a){var b=c,d=a;return b.includes(d.start)||d.includes(b.start)||b.includes(d.end)||d.includes(b.end)},this.take=function(a,b){b?a=b+a:b=0;for(var d=a>c.length?c.length:a,e=[],f=b;d>f;f++)e.push(c.start+f);return e},this.toString=function(){return c.start+"-"+c.end},this.toArray=function(){for(var a=[],b=c.start;b<=c.end;b++)a.push(b);return a}}}),angular.module("arethusa.sg").factory("SgGrammarRetriever",["configurator","Range",function(a,b){function c(a){var c=a.split(";");return arethusaUtil.map(c,function(a){return new b(a.split("-"))})}function d(a){return arethusaUtil.inject({},a,function(a,b){var c=arethusaUtil.inject([],f,function(a,c,d){b.sharesElements(d)&&a.push(c)});c.length&&(a[b.toString()]=c)})}function e(a,b,c){var d=arethusaUtil.inject([],b.take(5),function(b,c){var d="#s"+c,e=angular.element(d,angular.element(a));b.push(e.prev(":header")),b.push(e)});c(d)}var f={"body.1_div1.1_div2.1":new b(1,45),"body.1_div1.1_div2.2":new b(46,76),"body.1_div1.1_div2.3":new b(77,132),"body.1_div1.1_div2.4":new b(133),"body.1_div1.1_div2.5":new b(134,137),"body.1_div1.1_div2.6":new b(138,148),"body.1_div1.1_div2.7":new b(149,187),"body.1_div1.1_div2.8":new b(188),"body.1_div1.2_div2.1":new b(189,193),"body.1_div1.2_div2.2":new b(194,204),"body.1_div1.2_div2.3":new b(205,210),"body.1_div1.2_div2.4":new b(211,312),"body.1_div1.2_div2.5":new b(313,324),"body.1_div1.2_div2.6":new b(325,340),"body.1_div1.2_div2.7":new b(341,346),"body.1_div1.2_div2.8":new b(347,354),"body.1_div1.2_div2.9":new b(355,495),"body.1_div1.2_div2.10":new b(496,821),"body.1_div1.3_div2.17":new b(838,856),"body.1_div1.3_div2.18":new b(857,858),"body.1_div1.3_div2.19":new b(859,865),"body.1_div1.3_div2.20":new b(866,868),"body.1_div1.3_div2.21":new b(869,899),"body.1_div1.4_div2.1":new b(900,905),"body.1_div1.4_div2.2":new b(906,920),"body.1_div1.4_div2.3":new b(921),"body.1_div1.4_div2.4":new b(922,924),"body.1_div1.4_div2.5":new b(925,926),"body.1_div1.4_div2.6":new b(927,928),"body.1_div1.4_div2.7":new b(929,937),"body.1_div1.4_div2.8":new b(938,943),"body.1_div1.4_div2.9":new b(944,948),"body.1_div1.4_div2.10":new b(949,995),"body.1_div1.4_div2.11":new b(996,1012),"body.1_div1.4_div2.12":new b(1013,1015),"body.1_div1.4_div2.13":new b(1016,1017),"body.1_div1.4_div2.14":new b(1018,1093),"body.1_div1.4_div2.15":new b(1094,1098),"body.1_div1.4_div2.16":new b(1099,1189),"body.1_div1.4_div2.17":new b(1190,1278),"body.1_div1.4_div2.18":new b(1279,1635),"body.1_div1.4_div2.19":new b(1636,1702),"body.1_div1.4_div2.20":new b(1703,1965),"body.1_div1.4_div2.21":new b(1966,2038),"body.1_div1.4_div2.22":new b(2039,2148),"body.1_div1.4_div2.23":new b(2149,2152),"body.1_div1.4_div2.24":new b(2153,2158),"body.1_div1.4_div2.25":new b(2159,2161),"body.1_div1.4_div2.26":new b(2162,2172),"body.1_div1.4_div2.27":new b(2173,2188),"body.1_div1.4_div2.28":new b(2189,2190),"body.1_div1.4_div2.29":new b(2191,2487),"body.1_div1.4_div2.30":new b(2488,2573),"body.1_div1.4_div2.31":new b(2574,2635),"body.1_div1.4_div2.32":new b(2636,2662),"body.1_div1.4_div2.33":new b(2663,2680),"body.1_div1.4_div2.34":new b(2681,2687),"body.1_div1.4_div2.35":new b(2688,2768),"body.1_div1.4_div2.36":new b(2769,3003),"body.1_div1.4_div2.37":new b(3004,3048)};return function(f){function g(a){return i.get({doc:a})}var h={},i=a.provideResource(f.resource);this.getData=function(a,f){var i=c(a),j=d(i);angular.forEach(j,function(a,c){var d=new b(c);angular.forEach(a,function(a,b){var c=h[a];c?e(c,d,f):g(a).then(function(b){c=b.data,h[a]=c,e(c,d,f)})})})}}}]),angular.module("arethusa.sg").service("sg",["state","configurator","$cacheFactory","plugins","notifier",function(a,b,c,d,e){function f(){b.getConfAndDelegate(x,["labels"]),y=b.getRetriever(x.conf.retriever)}function g(){var a=this;this.morph={},this.ancestors=[],this.definingAttrs=[],this.menu={},this.hasChanged=!0,this.isSgTemplate=!0,this.markChange=function(){a.hasChanged=!0}}function h(a){arethusaUtil.empty(a.ancestors),a.definingAttrs=[]}function i(a){return a&&a.isSgTemplate}function j(a){return a&&a.ancestors&&!a.isTemplate}function k(a){var b=new g,c=a.morphology||{};return b.string=a.string,p(c,b),b}function l(){return arethusaUtil.inject({},a.tokens,function(a,b,c){var d,e=c.sg;i(e)?d=e:(d=k(c),j(e)&&n(e,d)),a[b]=d})}function m(a,b,c){var d=b.join(" ");return"Failed to parse SG annotation (in "+d+" at "+c+" for "+a+")"}function n(a,b){var c=a.ancestors,d=b.menu;angular.forEach(c,function(a,f){if(d){var g=d[a]||d.nested;if(!g)return e.error(m(b.string,c,a)),e.warning(A),void(d=void 0);b.ancestors.push(g),d=g.nested}})}function o(a,b){return!angular.equals(a,b)}function p(a,b){return o(b.morph,a.attributes)&&(arethusaUtil.empty(b.morph),angular.extend(b.morph,a.attributes),q(x.labels,b)),b}function q(a,b){h(b),t(x.labels,b,b.definingAttrs),v(b),r(b),b.markChange()}function r(a){var b=s(a);z.get(b)||z.put(b,a.definingAttrs)}function s(a){return arethusaUtil.inject([],a.morph,function(a,b,c){a.push(b+"-"+c)}).sort().join("|")}function t(a,b,c){var d=z.get(s(b));d?arethusaUtil.pushAll(c,d):arethusaUtil.inject(c,a,function(a,d,e){var f=e.dependency;if(f){var g,h=b.morph;angular.forEach(f,function(d,f){u(h[f],d)&&(e=angular.copy(e),a.push(e),g=e.nested,g&&(angular.forEach(g,function(a,c){if(a.nestedDependency){var d=[];t(a.nested,b,d),a.nested={nested:d.pop()}}}),t(g,b,c)))})}})}function u(a,b){return angular.isDefined(a)?a===b||"*"===b:void 0}function v(a){var b=a.definingAttrs,c=b[b.length-1]||{};a.menu=c.nested}function w(){angular.forEach(x.grammar,function(b,c){a.tokens[c].sg=b})}var x=this;this.name="sg";var y;this.labelAs="long",this.defineAncestors=!0;var z=c("sg",{number:100});this.defaultConf={displayName:"SG"};var A="You might be using an incompatible version of the SG tagset",B="Please select a morphological form first!";this.currentGrammar=function(){return arethusaUtil.inject({},a.selectedTokens,function(b,c,d){var e=a.tokens[c].morphology,f=x.grammar[c];f&&(e&&e.attributes?(delete f.hint,p(e,f)):(h(f),f.morph={},f.hint=B),b[c]=f)})},this.requestGrammar=function(a,b){y.getData(a,b)},this.canEdit=function(){return"editor"===x.mode},a.on("tokenAdded",function(a,b){x.grammar[b.id]=k(b)}),a.on("tokenRemoved",function(a,b){delete x.grammar[b.id]}),this.init=function(){d.doAfter("morph",function(){f(),x.grammar=l(),x.readerRequested=!1,w()})}}]),angular.module("arethusa.sg").run(["$templateCache",function(a){a.put("js/arethusa.sg/templates/ancestors.html",'<div class="text">\n  <div\n    ng-repeat="o in hierarchy"\n    ng-class="{underline: hover, italic: requested(o)}"\n    ng-mouseenter="hover = o.sections"\n    ng-mouseleave="hover = false"\n    ng-click="requestGrammar(o)"\n    style="padding: 2px 0"\n    ng-style="{\'margin-left\': 0.75 * $index + \'em\'}">\n    â€£ {{ o.long }}\n  </div>\n</div>\n'),a.put("js/arethusa.sg/templates/context_menu.html",'<div sg-context-menu-selector obj="token.sg"></div>\n'),a.put("js/arethusa.sg/templates/sg_context_menu_selector.html",'<ul class="nested-dropdown">\n  <li class="first-item">{{ heading }}\n    <ul\n      class="top-menu"\n      nested-menu-collection\n      property=""\n      current="obj"\n      ancestors="sg.defineAncestors"\n      all="obj.menu"\n      label-as="sg.labelAs"\n      empty-val="true">\n    </ul>\n  </li>\n</ul>\n\n'),a.put("js/arethusa.sg/templates/sg_grammar_reader.html",'<div ng-if="isVisible()">\n  <hr class="small"/>\n  <div id="sg-g-r"/>\n<div/>\n\n')}]);
//# sourceMappingURL=arethusa.sg.min.map